<!-- üîç BARRA DE B√öSQUEDA -->
<div class="filtro-container">
  <input
    type="text"
    class="form-control buscador-input"
    placeholder="Buscar mascotas por nombre, especie, lugar..."
    [(ngModel)]="searchText"
    (input)="applyFilters()"
  />

  <select
    [(ngModel)]="selectedEmotionalProfile"
    (change)="applyFilters()"
    class="combo-emocional estilizado"
  >
    <option value="">Todos los perfiles</option>
    <option value="Activo">Activo</option>
    <option value="Tranquilo">Tranquilo</option>
    <option value="Cari√±oso">Cari√±oso</option>
    <option value="Independiente">Independiente</option>
    <option  *ngIf="isLoggedIn" value="Recomendados">Recomendados</option>
  </select>
</div>

<div class="mascotas-container">
  <div class="mascotas-grid">
    <div
      class="mascota-card"
      *ngFor="let mascota of filteredMascotas; let i = index"
    >
      <div
        class="mascota-header"
        [style.background-color]="getProfileColor(mascota.perfil_emocional)"
      >
        <div class="mascota-badge">
          {{ mascota.perfil_emocional }}
        </div>

        <div class="mascota-image">
          <ng-container *ngIf="mascota.imagen; else fallbackIcon">
            <img
              *ngIf="mascota.imagen; else fallbackIcon"
              [src]="'data:image/jpeg;base64,' + mascota.imagen"
              [alt]="mascota.nombre"
            />
          </ng-container>
          <ng-template #fallbackIcon>
            <i class="fas fa-paw"></i>
          </ng-template>
        </div>
      </div>

      <div class="mascota-body">
        <h3>{{ mascota.nombre }}</h3>

        <div class="mascota-meta">
          <span
            ><i class="fas fa-dog" *ngIf="mascota.especie === 'Perro'"></i>
            <i class="fas fa-cat" *ngIf="mascota.especie === 'Gato'"></i>
            {{ mascota.especie }}</span
          >
          <span
            ><i class="fas fa-birthday-cake"></i>
            {{ formatAge(mascota.edad) }}
          </span>
          <span
            ><i class="fas fa-ruler-combined"></i> {{ mascota.tamano }}</span
          >
        </div>

        <p class="mascota-description">{{ mascota.descripcion }}</p>

        <div
          class="mascota-match"
          *ngIf="mascota.perfil_emocional === tipoEmocionalUsuario"
        >
          <span>Compatibilidad:</span>
          <div class="compat-stars">
            <i
              class="fas fa-paw"
              *ngFor="let _ of [0, 1, 2]; let idx = index"
              [class.filled]="idx < compatibilidadUsuario"
            ></i>
          </div>
        </div>

        <button class="btn-adoptar" (click)="verDetalle(mascota)">
          <i class="fas fa-heart"></i> Conocer m√°s
        </button>
      </div>
    </div>
  </div>
</div>
