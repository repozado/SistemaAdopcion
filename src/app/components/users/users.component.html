<div class="user-list-container">
 <h2 class="section-header">
    <i class="fas fa-users"></i>
    Gestión de Usuarios
  </h2>
  <div *ngIf="isLoading" class="loading-message">
    <i class="fas fa-spinner fa-spin"></i> Cargando usuarios...
  </div>

  <div *ngIf="message" class="alert success-alert">
    {{ message }}
  </div>

  <div *ngIf="error" class="alert alert-danger">
    {{ error }}
  </div>

  <div *ngIf="!isLoading && !error">
    <div *ngIf="users.length === 0" class="no-users-message">
      <p>No hay usuarios registrados.</p>
    </div>

    <div *ngIf="users.length > 0" class="table-responsive">
      <table class="user-table">
        <thead>
          <tr>
            <th>Email</th>
            <th>Nombre</th>
            <th>Teléfono</th>
            <th>Dirección</th>
            <th>Rol</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of users">
            <td data-label="Email">{{ user.email }}</td>
            <td data-label="Nombre">{{ user.nombre || 'N/A' }}</td>
            <td data-label="Teléfono">{{ user.telefono || 'N/A' }}</td>
            <td data-label="Dirección">{{ user.direccion || 'N/A' }}</td>
            <td data-label="Rol">{{ user.rol || 'Usuario' }}</td>
            <td data-label="Acciones">
              <button class="btn btn-sm btn-info" title="Editar" (click)="openEditModal(user)">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-sm btn-danger ms-2" title="Eliminar" (click)="confirmDelete(user.id)">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="modal" *ngIf="showEditModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Editar Usuario</h3>
        <button class="close-btn" (click)="closeEditModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="saveUserChanges()">
          <div class="form-group">
            <label for="editEmail">Email</label>
            <input type="email" id="editEmail" class="form-control" [ngModel]="currentUser.email" name="email" readonly>
          </div>
          <div class="form-group">
            <label for="editNombre">Nombre</label>
            <input type="text" id="editNombre" class="form-control" [(ngModel)]="currentUser.nombre" name="nombre">
          </div>
          <div class="form-group">
            <label for="editTelefono">Teléfono</label>
            <input type="text" id="editTelefono" class="form-control" [(ngModel)]="currentUser.telefono" name="telefono">
          </div>
          <div class="form-group">
            <label for="editDireccion">Dirección</label>
            <input type="text" id="editDireccion" class="form-control" [(ngModel)]="currentUser.direccion" name="direccion">
          </div>
          <div class="form-group">
            <label for="editRol">Rol</label>
            <select id="editRol" class="form-control" [(ngModel)]="currentUser.rol" name="rol">
              <option value="user">Usuario</option>
              <option value="shelter">Refugio</option>
              <option value="admin">Administrador</option>
            </select>
          </div>
          
          <div class="form-actions">
            <button type="button" class="btn btn-outline" (click)="closeEditModal()">Cancelar</button>
            <button type="submit" class="btn btn-primary">Guardar Cambios</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="modal" *ngIf="showConfirmDeleteModal">
    <div class="modal-content confirm-modal">
      <div class="modal-header">
        <h3>Confirmar Eliminación</h3>
        <button class="close-btn" (click)="cancelDelete()">&times;</button>
      </div>
      <div class="modal-body">
        <p>¿Estás seguro que deseas eliminar al usuario **{{ userToDelete?.email }}**?</p>
        <p>Esta acción no se puede deshacer.</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" (click)="cancelDelete()">Cancelar</button>
        <button class="btn btn-danger" (click)="deleteUser()">Eliminar</button>
      </div>
    </div>
  </div>

</div>